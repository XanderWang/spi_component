# 一个基于 SPI 的组件化框架

首先，我们思考下什么是组件化，什么是插件化？什么时候我们用组件化，什么时候我们用插件化？

## 什么是组件化，什么是插件化。

所谓的组件化就是将整个项目拆分为几个组件，单个组件高内聚，组件间低耦合，这些组件拼到一个编译成一个目标 app 。

所谓的插件化就是将整个项目拆分为几个模块，分别打包编译，在主 app 需要用到某个模块的时候
按需加载这些模块。

## 什么时候我们用组件化，什么时候我们用插件化

这是一个策略问题，用何种方式需要根据实际情况来。

刚刚说了，组件化是将项目拆分为几个组件，单个组件高内聚，组件间低耦合。所以复用会比较方
便，如果公司产品多可以考虑这种方式。

另外，组件化框架一般会允许组件单独编译，单独调试，由于组件一般不会太大，所以编译调试
单个组件的时间相较整体编译会少很多。而且组件化方式编译的 app 是常规模式编译的，可以
较好的适配新的 Android 版本，相较插件化更稳定。

插件化是将整个项目拆分为几个模块，和组件化类似，有相似的优势，但是一般插件化方案都
涉及 Hook 技术，而这些技术随便 Android 版本迭代，可能会被封杀，存在一些适配的风险，
可能会不稳定。

随着我们的业务发展，我们的主工程越来越复杂，不得不考虑组件化和插件化来简化我们的开发
工作，考虑到稳定性，我们决定改造我们的工程，后续切换到组件化开发。

## 组件化的一些思考

在改造的时候，我们采集了一下内部对于组件化需求

1. 学习成本低，希望比较容易上手(接入简单)。
2. 由于改造和迭代是同时进行的，希望拆分组件后，旧的代码不用做很多的修改，以前
是如何调用的，改造后还是那样调用。
3. 模块之前互相调用方便、高效。
4. 希望主App不要引入太多无关的代码。



这是一个基于 SPI 的组件化框架。框架的大致架构如下：

项目名称 | 作用
-------|-------
core | 框架的核心，就是 app 的骨架，定义了各个组件对外暴露的部分
app | app 的承载容器，就是对外发布的时候，用这个项目来编译，包含所有的组件
compx | 某个组件，依赖 core ，实现 core 里面对外暴露的业务逻辑等
single-alone/compx-alone | 组件单独调试编译入口


首先， `core` 模块定义了各种