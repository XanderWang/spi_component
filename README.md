# 一个基于 SPI 的组件化框架

首先，我们思考下什么是组件化，什么是插件化？什么时候我们用组件化，什么时候我们用插件化？

## 什么是组件化，什么是插件化。

所谓的组件化就是将整个项目拆分为几个组件，单个组件高内聚，组件间低耦合，这些组件拼到一起，编译成一个目标 app 。

所谓的插件化就是将整个项目拆分为几个模块，分别打包编译，在主 app 需要用到某个模块的时候
按需加载这些模块。

## 什么时候我们用组件化，什么时候我们用插件化

这是一个策略问题，用何种方式需要根据实际情况来。

刚刚说了，组件化是将项目拆分为几个组件，单个组件高内聚，组件间低耦合。所以复用会比较方
便，如果公司产品多可以考虑这种方式。

另外，组件化框架一般会允许组件单独编译，单独调试，由于组件一般不会太大，所以编译调试
单个组件的时间相较整体编译会少很多。而且组件化方式编译的 app 是常规模式编译的，可以
较好的适配新的 Android 版本，相较插件化更稳定。

插件化是将整个项目拆分为几个模块，和组件化类似，有相似的优势，但是一般插件化方案都
涉及 Hook 技术，而这些技术随便 Android 版本迭代，可能会被封杀，存在一些适配的风险，
可能会不稳定。

随着我们的业务发展，我们的主工程越来越复杂，不得不考虑组件化和插件化来简化我们的开发
工作，考虑到稳定性，我们决定改造我们的工程，后续切换到组件化开发。

## 组件化的一些思考

在改造的时候，我们采集了一下内部对于组件化需求：

1. 学习成本低，希望比较容易上手(接入简单)。
2. 现有的代码改动少，调用方式最好不变。
3. 组件之前互相调用(希望可以直接使用其他组件的资源，相对显式打开其他组件的页面等)方便、高效。
4. 希望不要引入太多无关的代码。

参考一些开源的组件化方案，有很多借鉴的地方，但是感觉还是有些不是很符合我们的需求，比如：

1. 组件间的调用不是很方便，Activity 的跳转还好，但是涉及到 Fragment 的调用的时候，
就不是很方便了，基本无解。
2. 有些组件的初始化需要放到 Application 里面，或者需要 Application 里面的一些方法，
这些都不是很适合
3. 新增组件脚本等都需要修改。

鉴于以上的一些特点，我们希望可以在现有的基础上做一些优化，希望组件化开发更简单，更方便。

于是，我设想了这个基于 SPI 的组件化框架。框架的大致架构如下：

|模块名称 | 作用|
|------- | ------- |
core | 框架的核心，就是 app 的骨架，定义了各个组件对外暴露的部分。可通过 getXXX 方式暴露出去。而且比较灵活， Fragment 资源图片等都可以暴露。
app | app 的承载容器，就是对外发布的时候，用这个项目来编译，包含所有的组件
compx | 某个组件，依赖 core ，实现 core 里面这个组件对外暴露的业务逻辑等。
single-alone/compx-alone | 组件单独调试编译入口，就是编译出来的 app 只有这一个组件实现了。


`core` 模块定义了各种组件承担的业务和对外暴露的一些资源等，主要是通过接口暴露。
同时提供各个模块的默认实现。

`compx` 模块是一个组件的实现，实现的是 core 模块里面定义的的组件，需要依赖 core 
模块。

app 模块，就是我们对外发布的 app ，把所有的组件放到一起编译。 依赖 core 和所有的 comp 
模块。

single-alone/compx-alone 某个组件的 app ，即依赖 core 和某个 comp 模块，
方便单独调试某个模块。

## 组件是如何工作的

首先，组件是如何被识别的呢？
